{% extends 'base.html' %}

{% block content %}
<h2>Adicionar crítica para: {{ filme.titulo }}</h2>

<form method="POST">
    {% csrf_token %}

    <div class="form-group">
        <label for="texto">Crítica:</label>
        <textarea id="texto" name="texto" class="form-control" rows="5" required></textarea>
    </div>

    <div class="form-group">
        <label>Nota:</label>
        <div class="estrelas" id="estrelas">
            {% for i in notas %}
                <span class="estrela" data-value="{{ i }}">★</span>
            {% endfor %}
        </div>
        <input type="hidden" name="nota" id="nota" required>
    </div>

    <button type="submit" class="btn btn-primary">Enviar crítica</button>
</form>

<style>
.estrelas {
    display: flex;
    flex-direction: row-reverse;
    font-size: 2rem;
    cursor: pointer;
}

/* Estrela cinza por padrão */
.estrela {
    color: #ccc;
    position: relative;
}

/* Estrela preenchida */
.estrela.dourada {
    color: gold;
}
</style>

<script>
const estrelas = document.querySelectorAll('.estrela');
const notaInput = document.getElementById('nota');

function pintarEstrelas(valor) {
    estrelas.forEach(star => {
        if(parseFloat(star.dataset.value) <= valor) {
            star.classList.add('dourada');
        } else {
            star.classList.remove('dourada');
        }
    });
}

estrelas.forEach(star => {
    // Hover
    star.addEventListener('mouseover', () => {
        pintarEstrelas(parseFloat(star.dataset.value));
    });

    // Click
    star.addEventListener('click', () => {
        notaInput.value = parseFloat(star.dataset.value);
        pintarEstrelas(parseFloat(star.dataset.value));
    });

    // Mouseout volta ao valor selecionado
    star.addEventListener('mouseout', () => {
        pintarEstrelas(parseFloat(notaInput.value) || 0);
    });
});
</script>
{% endblock %}