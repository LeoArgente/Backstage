{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Busca - Backstage</title>
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/movies.css' %}">
</head>
<body>
  <div class="container" style="padding: 20px;">
    <!-- Formulário de busca -->
    <div class="search-form-container" style="margin-bottom: 30px;">
      <h1>Buscar Filmes e Séries</h1>
      
      <form method="get" action="{% url 'backstage:buscar' %}" class="advanced-search-form">
        <div class="search-input-group">
          <input 
            type="text" 
            name="q" 
            value="{{ query }}" 
            placeholder="Digite o título, nome do ator/diretor ou gênero..." 
            class="search-input"
            style="width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #1a1a1a; color: white;"
          />
        </div>
        
        <div class="search-filters" style="margin: 15px 0;">
          <label style="margin-right: 20px;">
            <input type="radio" name="tipo" value="titulo" {% if tipo_busca == 'titulo' %}checked{% endif %}> Título
          </label>
          <label style="margin-right: 20px;">
            <input type="radio" name="tipo" value="pessoa" {% if tipo_busca == 'pessoa' %}checked{% endif %}> Ator/Diretor
          </label>
          <label>
            <input type="radio" name="tipo" value="genero" {% if tipo_busca == 'genero' %}checked{% endif %}> Gênero
          </label>
        </div>
        
        <button type="submit" class="btn btn-primary">Buscar</button>
      </form>
    </div>

    {% if query %}
    <div class="search-results">
      <h2>Resultados para "{{ query }}"</h2>
      
      {% if resultados_pessoas %}
      <div class="pessoas-section" style="margin-bottom: 30px;">
        <h3>Pessoas encontradas:</h3>
        <div class="pessoas-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
          {% for pessoa in resultados_pessoas %}
          <div class="pessoa-card" style="padding: 15px; background: #222; border-radius: 8px;">
            {% if pessoa.profile_path %}
            <img src="{{ tmdb_image_base }}w200{{ pessoa.profile_path }}" alt="{{ pessoa.name }}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
            {% endif %}
            <h4 style="margin: 10px 0 5px;">{{ pessoa.name }}</h4>
            <p style="color: #888; font-size: 14px;">{{ pessoa.known_for_department|default:"Ator/Atriz" }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if resultados_filmes %}
      <div class="filmes-section">
        <h3>Filmes encontrados:</h3>
        <div class="movies-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
          {% for filme in resultados_filmes %}
          <div class="movie-card" style="background: #222; border-radius: 8px; overflow: hidden;">
              {% if filme.tipo == 'serie' %}
              <a href="{% url 'backstage:detalhes_serie' filme.tmdb_id %}" style="text-decoration: none; color: inherit;">
              {% else %}
              <a href="{% url 'backstage:detalhes_filme' filme.tmdb_id %}" style="text-decoration: none; color: inherit;">
              {% endif %}
              {% if filme.poster_path %}
              <img src="{{ tmdb_image_base }}w500{{ filme.poster_path }}" alt="{{ filme.titulo }}" style="width: 100%; height: 300px; object-fit: cover;">
              {% else %}
              <div style="width: 100%; height: 300px; background: #333; display: flex; align-items: center; justify-content: center; color: #666;">
                Sem imagem
              </div>
              {% endif %}
              
              <div style="padding: 15px;">
                <h4 style="margin: 0 0 8px; font-size: 16px;">
                  {{ filme.titulo }}
                  {% if filme.tipo == 'serie' %}
                  <span style="background: #667eea; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-left: 5px;">SÉRIE</span>
                  {% endif %}
                </h4>
                <p style="color: #888; font-size: 14px; margin: 0 0 8px;">{{ filme.ano_lancamento }}</p>
                {% if filme.nota_tmdb %}
                <div style="display: flex; align-items: center; gap: 5px;">
                  <span style="color: #ffd700;">★</span>
                  <span>{{ filme.nota_tmdb|floatformat:1 }}</span>
                </div>
                {% endif %}
              </div>
            </a>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if not resultados_filmes and not resultados_pessoas %}
      <div class="no-results" style="text-align: center; padding: 40px; color: #666;">
        <h3>Nenhum resultado encontrado</h3>
        <p>Tente buscar com outros termos ou mude o tipo de busca.</p>
      </div>
      {% endif %}

    </div>
    {% else %}
    <div class="suggestions" style="margin-top: 30px;">
      <h3>Gêneros populares:</h3>
      <div class="generos-list" style="display: flex; flex-wrap: wrap; gap: 10px;">
        {% for genero in generos|slice:":10" %}
        <a href="?q={{ genero.name }}&tipo=genero" class="genero-tag" 
           style="padding: 8px 15px; background: #333; color: white; text-decoration: none; border-radius: 20px; font-size: 14px;">
          {{ genero.name }}
        </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}

  </div>
</body>
</html>