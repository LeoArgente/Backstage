{% extends "backstage/index.html" %}
{% load static %}

{% block title %}Comunidades - Backstage{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/community.css' %}">
{% endblock %}

{% block main_content %}
<div class="community-container">
  <div class="community-header">
    <h1>Minhas Comunidades</h1>
    <button id="criar-comunidade-btn" class="btn btn-primary">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Criar Comunidade
    </button>
  </div>

  <!-- Seção das minhas comunidades -->
  <div class="communities-section">
    <h2>Suas Comunidades</h2>
    {% if minhas_comunidades %}
      <div class="communities-grid">
        {% for membro in minhas_comunidades %}
          <div class="community-card">
            <div class="community-info">
              <h3>{{ membro.comunidade.nome }}</h3>
              <p class="community-description">{{ membro.comunidade.descricao|default:"Sem descrição" }}</p>
              <div class="community-meta">
                <span class="member-count">{{ membro.comunidade.membros.count }} membros</span>
                {% if membro.role == 'admin' %}
                  <span class="role-badge admin">Admin</span>
                {% elif membro.role == 'mod' %}
                  <span class="role-badge mod">Moderador</span>
                {% endif %}
              </div>
            </div>
            <div class="community-actions">
              <a href="{% url 'backstage:detalhes_comunidade' membro.comunidade.slug %}" class="btn btn-outline">Ver Detalhes</a>
              {% if membro.role == 'member' %}
                <button class="btn btn-danger sair-comunidade" data-slug="{{ membro.comunidade.slug }}">Sair</button>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="1.5"/>
          <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="1.5"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        <h3>Você ainda não participa de nenhuma comunidade</h3>
        <p>Crie sua primeira comunidade ou peça para um amigo te convidar!</p>
      </div>
    {% endif %}
  </div>

  <!-- Seção de entrada por convite -->
  <div class="invite-section">
    <h2>Tem um código de convite?</h2>
    <div class="invite-form">
      <input type="text" id="codigo-convite" placeholder="Digite o código de convite" class="form-input">
      <button id="entrar-por-convite" class="btn btn-secondary">Entrar na Comunidade</button>
    </div>
  </div>
</div>

<!-- Modal para criar comunidade -->
<div id="modal-criar-comunidade" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Criar Nova Comunidade</h2>
      <button class="modal-close">&times;</button>
    </div>
    <form id="form-criar-comunidade">
      {% csrf_token %}
      <div class="form-group">
        <label for="nome-comunidade">Nome da Comunidade</label>
        <input type="text" id="nome-comunidade" name="nome" required class="form-input">
      </div>
      <div class="form-group">
        <label for="descricao-comunidade">Descrição</label>
        <textarea id="descricao-comunidade" name="descricao" rows="3" class="form-input"></textarea>
      </div>
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" id="publica-comunidade" name="publica">
          <span class="checkmark"></span>
          Comunidade pública (qualquer um pode encontrar)
        </label>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-outline modal-cancel">Cancelar</button>
        <button type="submit" class="btn btn-primary">Criar Comunidade</button>
      </div>
    </form>
  </div>
</div>

<script src="{% static 'js/community.js' %}"></script>
{% endblock %}