{% load static %}

<!-- Community Chat Component -->
<div class="community-chat"
     id="community-chat"
     data-community-id="{{ comunidade.id }}"
     data-current-user="{{ user.username }}"
     data-is-admin="{% if is_admin %}true{% else %}false{% endif %}">

  <!-- Chat Header -->
  <div class="chat-header">
    <div class="chat-header-left">
      <a href="{% url 'backstage:comunidade' %}" class="chat-back-button" title="Voltar para comunidades">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </a>
      <h3>Chat da Comunidade</h3>
      <span class="chat-members-count">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline; vertical-align: middle; margin-right: 4px;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
        {{ comunidade.membros.count }} membro{{ comunidade.membros.count|pluralize }}
      </span>
    </div>
    <div class="chat-header-right">
      {% if is_admin %}
      <button type="button" class="chat-clear-button" id="chat-clear" title="Limpar chat">
        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
        </svg>
      </button>
      {% endif %}
    </div>
  </div>

  <!-- Messages Container -->
  <div class="chat-messages" id="chat-messages">
    <div class="chat-loading">
      <div class="chat-loading-spinner"></div>
      Carregando mensagens...
    </div>
  </div>

  <!-- Input Area -->
  <div class="chat-input-area">
    <form class="chat-input-form" id="chat-form">
      <button type="button" class="chat-attach-button" id="chat-attach" title="Anexar filme ou série">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
        </svg>
      </button>
      <div class="chat-input-wrapper">
        <textarea
          id="chat-input"
          class="chat-input"
          placeholder="Digite sua mensagem..."
          rows="1"
          maxlength="2000"></textarea>
      </div>
      <button type="submit" class="chat-send-button" id="chat-send" disabled>
        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
        </svg>
        Enviar
      </button>
    </form>
  </div>
</div>

<!-- Movie/Serie Search Modal -->
<div class="chat-media-modal" id="chat-media-modal">
  <div class="chat-modal-overlay" id="modal-overlay"></div>
  <div class="chat-modal-content">
    <div class="chat-modal-header">
      <h3>Anexar Filme ou Série</h3>
      <button type="button" class="chat-modal-close" id="modal-close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="chat-modal-body">
      <div class="chat-modal-search">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="search-icon">
          <circle cx="11" cy="11" r="8" stroke-width="2"/>
          <path stroke-linecap="round" stroke-width="2" d="M21 21l-4.35-4.35"/>
        </svg>
        <input
          type="text"
          class="chat-modal-search-input"
          id="media-search-input"
          placeholder="Buscar filme ou série..."
          autocomplete="off"
        />
      </div>
      <div class="chat-modal-results" id="media-search-results">
        <div class="search-placeholder">
          <svg width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          <p>Digite para buscar filmes ou séries</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Load Chat Assets -->
<link rel="stylesheet" href="{% static 'css/community-chat.css' %}?v=1.0">
<script src="{% static 'js/community-chat.js' %}?v=1.0"></script>
