{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Backstage</title>
  <link rel="icon" type="image/png" href="{% static 'images/Icone_Backstage.png' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/movies.css' %}">
  <link rel="stylesheet" href="{% static 'css/movie_details.css' %}">
  <link rel="stylesheet" href="{% static 'css/dropdown.css' %}">
  <link rel="stylesheet" href="{% static 'css/mobile.css' %}">
  <link rel="stylesheet" href="{% static 'css/intro.css' %}">
  {% block extra_css %}{% endblock %}
</head>
<body>
  <!-- Video Intro Overlay -->
  <div class="intro-overlay">
    <div class="intro-video-container">
      <video class="intro-video" muted playsinline preload="auto">
        <source src="{% static 'videos/intro.mp4' %}" type="video/mp4">
        Seu navegador não suporta vídeo HTML5.
      </video>
      <button class="intro-skip-btn" aria-label="Pular introdução">
        Pular
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="13 17 18 12 13 7"></polyline>
          <polyline points="6 17 11 12 6 7"></polyline>
        </svg>
      </button>
    </div>
  </div>

  {% include 'backstage/_mobile_header.html' %}
    <header class="site-header">
    <div class="container">
      <nav class="nav-primary">
        <a class="brand" href="{% url 'backstage:index' %}">
            <img src="{% static 'images/Logo_Backstage_branca.png' %}"
                 alt="Backstage Logo"
                 width="250">
        </a>

        <div class="nav-menu">
          <a href="{% url 'backstage:index' %}" class="nav-link active">Início</a>
          <a href="{% url 'backstage:movies' %}" class="nav-link">Filmes</a>
          <a href="{% url 'backstage:series' %}" class="nav-link">Séries</a>
          <a href="{% url 'backstage:lists' %}" class="nav-link">Listas</a>
          <a href="{% url 'backstage:comunidade' %}" class="nav-link">Comunidade</a>
        </div>

        <div class="nav-actions">
          <form method="get" action="{% url 'backstage:buscar' %}" class="search-container">
            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
              <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <input type="search" name="q" class="search-input" placeholder="Buscar filmes, séries..." autocomplete="off" />
            <input type="hidden" name="tipo" value="titulo" />
            <div class="search-suggestions"></div>
          </form>

          {% include 'backstage/_notifications.html' %}

          {% include 'backstage/_user_dropdown.html' %}
        </div>
      </nav>
    </div>
  </header>

<!-- Hero Section -->
  <section class="hero">
    <!-- Desktop backdrop with dual layers for smooth crossfade -->
    <div class="hero-backdrop-desktop">
      <img class="hero-backdrop-img hero-backdrop-img-1" src="" alt="" />
      <img class="hero-backdrop-img hero-backdrop-img-2" src="" alt="" style="opacity: 0;" />
      <div class="hero-gradient"></div>
    </div>

    <!-- Mobile backdrop with dual layers for smooth crossfade -->
    <div class="hero-backdrop-mobile">
      <img class="hero-backdrop-img hero-backdrop-img-1" src="" alt="" />
      <img class="hero-backdrop-img hero-backdrop-img-2" src="" alt="" style="opacity: 0;" />
      <div class="hero-gradient"></div>
    </div>

    <!-- Hero content -->
    <div class="container hero-content">
      <div class="hero-info">
        <span class="hero-badge">Carregando...</span>
        <h1 class="hero-title">Carregando os filmes em alta...</h1>
        <div class="hero-meta">
          <span class="hero-year">2024</span>
          <span class="hero-duration">120 min</span>
          <span class="hero-rating">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            4.5
          </span>
        </div>
        <div class="hero-actions">
          <button class="btn btn-primary btn-large">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
            Assistir Trailer
          </button>
          <button class="btn btn-secondary btn-large">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14"/>
            </svg>
            Adicionar à Lista
          </button>
        </div>
      </div>
    </div>

    <!-- Navigation indicators (will be populated by JS) -->
    <div class="hero-indicators"></div>
  </section>

  <main class="container">

    <!-- GOATS (Greatest of All Time) -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          GOATS
        </h2>
      </div>
      <div class="carousel">
        <button class="carousel-btn prev">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <div class="carousel-track" id="goats-movies">
          <!-- Filmes GOATS serão inseridos via JS -->
        </div>
        <button class="carousel-btn next">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </section>


    <!-- Em Cartaz -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M7 4V2a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v2H2a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-1V2a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2H7z"/>
            <path d="M5 9h14M5 13h14M5 17h14"/>
          </svg>
          Em Cartaz
        </h2>
      </div>
      <div class="carousel">
        <button class="carousel-btn prev">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <div class="carousel-track" id="em-cartaz-movies">
          <!-- Filmes em cartaz serão inseridos via JS -->
        </div>
        <button class="carousel-btn next">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Clássicos Imperdíveis -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M7 2h3l2 3h7a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"/>
            <circle cx="12" cy="13" r="3"/>
          </svg>
          Clássicos Imperdíveis
        </h2>
      </div>
      <div class="carousel">
        <button class="carousel-btn prev">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <div class="carousel-track" id="classicos-movies">
          <!-- Filmes clássicos serão inseridos via JS -->
        </div>
        <button class="carousel-btn next">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Recomendados para você -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
          </svg>
          Recomendados para você
        </h2>
        <button class="refresh-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.64A9 9 0 0 0 20.49 15"/>
          </svg>
          Atualizar
        </button>
      </div>
      <div class="carousel">
        <button class="carousel-btn prev">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <div class="carousel-track" id="recommended-movies">
          <!-- Filmes serão inseridos via JS -->
        </div>
        <button class="carousel-btn next">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </section>

    <!-- Activity Feed -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          Atividade dos amigos
        </h2>
      </div>
      <div class="activity-feed">
        {% if user.is_authenticated %}
          {% if atividades_amigos %}
            {% for atividade in atividades_amigos %}
            <div class="activity-item">
              <img src="https://ui-avatars.com/api/?name={{ atividade.usuario.username }}&background=random&size=48" class="activity-avatar" alt="{{ atividade.usuario.username }}">
              <div class="activity-content">
                <p>
                  <strong>{{ atividade.usuario.username }}</strong> avaliou 
                  {% if atividade.tipo == 'filme' %}
                    <a href="{% url 'backstage:detalhes_filme' atividade.tmdb_id %}">{{ atividade.titulo }}</a>
                  {% else %}
                    <a href="{% url 'backstage:detalhes_serie' atividade.tmdb_id %}">{{ atividade.titulo }}</a>
                  {% endif %}
                  com
                  <span class="rating-stars">{% for i in "12345" %}{% if forloop.counter <= atividade.nota %}★{% else %}☆{% endif %}{% endfor %}</span>
                </p>
                <span class="activity-time">{{ atividade.data|timesince }} atrás</span>
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div class="activity-empty">
              <p>Nenhuma atividade dos seus amigos ainda.</p>
              <a href="{% url 'backstage:amigos' %}#buscar" class="btn-primary">Adicionar Amigos</a>
            </div>
          {% endif %}
        {% else %}
          <div class="activity-empty">
            <p>Faça login para ver as atividades dos seus amigos!</p>
            <a href="{% url 'backstage:login' %}" class="btn-primary">Fazer Login</a>
          </div>
        {% endif %}
      </div>
    </section>
  </main>

  <!-- Footer aprimorado -->
  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <div class="brand">
            <img src="{% static 'images/Logo_Backstage_branca.png' %}"
                 alt="Backstage Logo"
                 width="40" height="40">
          </div>
          <p class="footer-description">
            Sua jornada cinematográfica começa aqui. Entre no Backstage e registre cada frame.
          </p>
        </div>
        
        <div class="footer-section">
          <h3 class="footer-title">Explorar</h3>
          <ul class="footer-links">
            <li><a href="{% url 'backstage:index' %}">Início</a></li>
            <li><a href="{% url 'backstage:movies' %}">Filmes</a></li>
            <li><a href="{% url 'backstage:series' %}">Séries</a></li>
            <li><a href="{% url 'backstage:lists' %}">Listas</a></li>
            <li><a href="{% url 'backstage:comunidade' %}">Comunidade</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h3 class="footer-title">Suporte</h3>
          <ul class="footer-links">
            <li><a href="#">Ajuda</a></li>
            <li><a href="#">Contato</a></li>
            <li><a href="#">Política de Privacidade</a></li>
            <li><a href="#">Termos de Uso</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h3 class="footer-title">Conecte-se</h3>
          <div class="social-links">
            <a href="#" class="social-link" aria-label="TikTok">
              <svg width="20" height="20" viewBox="0 0 96 96" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="96" height="96" rx="21" fill="black" style="fill:black;fill-opacity:1;"/>
                <path d="M73.31 25.7456C72.785 25.4743 72.274 25.1769 71.7788 24.8545C70.3389 23.9025 69.0186 22.7808 67.8465 21.5135C64.9139 18.158 63.8186 14.7538 63.4151 12.3705H63.4313C63.0943 10.3921 63.2337 9.11214 63.2547 9.11214H49.8974V60.7624C49.8974 61.4558 49.8974 62.1412 49.8682 62.8185C49.8682 62.9027 49.8601 62.9805 49.8553 63.0712C49.8553 63.1085 49.8553 63.1474 49.8472 63.1863C49.8472 63.196 49.8472 63.2057 49.8472 63.2154C49.7064 65.0686 49.1123 66.8588 48.1173 68.4286C47.1222 69.9983 45.7566 71.2994 44.1407 72.2175C42.4565 73.1757 40.5517 73.6782 38.614 73.6757C32.3906 73.6757 27.3468 68.6011 27.3468 62.334C27.3468 56.0669 32.3906 50.9923 38.614 50.9923C39.7921 50.9912 40.9629 51.1766 42.083 51.5415L42.0992 37.9412C38.6989 37.502 35.2444 37.7722 31.9538 38.7348C28.6631 39.6975 25.6077 41.3317 22.9802 43.5343C20.678 45.5346 18.7425 47.9214 17.2608 50.5872C16.6969 51.5594 14.5695 55.4658 14.3119 61.8058C14.1499 65.4044 15.2306 69.1326 15.7458 70.6734V70.7058C16.0699 71.6132 17.3256 74.7094 19.372 77.3197C21.0221 79.4135 22.9716 81.2527 25.1579 82.7783V82.7459L25.1903 82.7783C31.6567 87.1724 38.8263 86.884 38.8263 86.884C40.0674 86.8338 44.2249 86.884 48.9463 84.6464C54.183 82.1658 57.1642 78.47 57.1642 78.47C59.0688 76.2618 60.5832 73.7452 61.6426 71.0282C62.8513 67.8509 63.2547 64.0401 63.2547 62.5171V35.1155C63.4168 35.2127 65.5749 36.6401 65.5749 36.6401C65.5749 36.6401 68.6842 38.633 73.5352 39.9309C77.0155 40.8544 81.7045 41.0488 81.7045 41.0488V27.7887C80.0615 27.9669 76.7255 27.4485 73.31 25.7456Z" fill="white" style="fill:white;fill-opacity:1;"/>
              </svg>
            </a>
            <a href="#" class="social-link" aria-label="Twitter">
              <svg width="20" height="20" viewBox="0 0 300 271" fill="black" xmlns="http://www.w3.org/2000/svg">
                <path d="m236 0h46l-101 115 118 156h-92.6l-72.5-94.8-83 94.8h-46l107-123-113-148h94.9l65.5 86.6zm-16.1 244h25.5l-165-218h-27.4z"/>
              </svg>
            </a>
            <a href="#" class="social-link" aria-label="Facebook">
              <svg width="20" height="20" viewBox="0 0 14222 14222" xmlns="http://www.w3.org/2000/svg">
                <path fill="#1877F2" d="M14222 7111c0,-3927 -3184,-7111 -7111,-7111 -3927,0 -7111,3184 -7111,7111 0,3549 2600,6491 6000,7025l0 -4969 -1806 0 0 -2056 1806 0 0 -1567c0,-1782 1062,-2767 2686,-2767 778,0 1592,139 1592,139l0 1750 -897 0c-883,0 -1159,548 -1159,1111l0 1334 1972 0 -315 2056 -1657 0 0 4969c3400,-533 6000,-3475 6000,-7025z"/>
                <path fill="white" d="M9879 9167l315 -2056 -1972 0 0 -1334c0,-562 275,-1111 1159,-1111l897 0 0 -1750c0,0 -814,-139 -1592,-139 -1624,0 -2686,984 -2686,2767l0 1567 -1806 0 0 2056 1806 0 0 4969c362,57 733,86 1111,86 378,0 749,-30 1111,-86l0 -4969 1657 0z"/>
              </svg>
            </a>
            <a href="#" class="social-link" aria-label="Instagram">
              <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="url(#instagram-gradient)">
                <defs>
                  <linearGradient id="instagram-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#833ab4;stop-opacity:1" />
                    <stop offset="50%" style="stop-color:#fd1d1d;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#fcb045;stop-opacity:1" />
                  </linearGradient>
                </defs>
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
              </svg>
            </a>
            <a href="#" class="social-link" aria-label="YouTube">
              <svg width="20" height="20" viewBox="0 0 28.57 20" xmlns="http://www.w3.org/2000/svg">
                <g>
                  <path d="M27.9727 3.12324C27.6435 1.89323 26.6768 0.926623 25.4468 0.597366C23.2197 2.24288e-07 14.285 0 14.285 0C14.285 0 5.35042 2.24288e-07 3.12323 0.597366C1.89323 0.926623 0.926623 1.89323 0.597366 3.12324C2.24288e-07 5.35042 0 10 0 10C0 10 2.24288e-07 14.6496 0.597366 16.8768C0.926623 18.1068 1.89323 19.0734 3.12323 19.4026C5.35042 20 14.285 20 14.285 20C14.285 20 23.2197 20 25.4468 19.4026C26.6768 19.0734 27.6435 18.1068 27.9727 16.8768C28.5701 14.6496 28.5701 10 28.5701 10C28.5701 10 28.5677 5.35042 27.9727 3.12324Z" fill="#FF0000"/>
                  <path d="M11.4253 14.2854L18.8477 10.0004L11.4253 5.71533V14.2854Z" fill="white"/>
                </g>
              </svg>
            </a>
            <a href="#" class="social-link" aria-label="LinkedIn">
              <svg width="20" height="20" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <g transform="translate(-373.642,-318.344)">
                  <path fill="#1D8CB5" d="M583.659,328.849H419.625c-19.599,0-35.487,15.888-35.487,35.487v164.015c0,19.599,15.888,35.486,35.487,35.486h164.033c19.599,0,35.487-15.888,35.487-35.486V364.337C619.146,344.738,603.257,328.849,583.659,328.849z"/>
                  <linearGradient id="path1950_1_" gradientUnits="userSpaceOnUse" x1="-808.8727" y1="199.8918" x2="-860.5692" y2="49.2029" gradientTransform="matrix(-0.5915 0 0 -0.5915 -34.5417 412.5453)">
                    <stop offset="0" style="stop-color:#FFFFFF"/>
                    <stop offset="1" style="stop-color:#FFFFFF;stop-opacity:0"/>
                  </linearGradient>
                  <path opacity="0.7811" fill="url(#path1950_1_)" d="M557.056,338.895H446.227c-29.337,0-52.955,23.81-52.955,53.385v108.127c0.95,23.087,4.603,8.491,11.555-17.075c8.081-29.713,34.396-55.682,66.445-75.145c24.461-14.855,51.84-24.341,101.679-25.244C601.216,382.432,598.721,346.26,557.056,338.895z"/>
                </g>
                <g transform="translate(-200.55198,-393.96227)">
                  <g transform="matrix(1.018827,0,0,-1.018827,170.5996,498.03288)">
                    <path fill="#FFFFFF" d="M109.495-101.774V2.533H74.828v-104.307H109.495z M92.168,16.775c12.081,0,19.612,8.01,19.612,18.021c-0.224,10.233-7.531,18.021-19.385,18.021c-11.864,0-19.615-7.788-19.615-18.021c0-10.011,7.521-18.021,19.159-18.021H92.168L92.168,16.775z"/>
                    <path fill="#FFFFFF" d="M128.681-101.774h34.673v58.249c0,3.119,0.226,6.235,1.143,8.462c2.5,6.232,8.209,12.681,17.784,12.681c12.547,0,17.562-9.568,17.562-23.588v-55.804h34.666v59.81c0,32.039-17.1,46.946-39.913,46.946c-18.701,0-26.915-10.45-31.476-17.571h0.234V2.533h-34.673C129.141-7.253,128.681-101.774,128.681-101.774L128.681-101.774z"/>
                  </g>
                </g>
              </svg>
            </a>
          </div>
        </div>
            </a>
          </div>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2025 Backstage. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Popup de Adicionar à Lista -->
  <div class="list-popup-overlay" id="listPopupOverlay">
    <div class="list-popup">
      <div class="popup-header">
        <h3 id="popupTitle">Adicionar à Lista</h3>
        <button class="close-popup" onclick="hideListPopup()">&times;</button>
      </div>

      <!-- Opções principais -->
      <div class="popup-content" id="popupOptions">
        <!-- Lista de listas existentes -->
        <div id="existingLists">
          <div id="loadingLists">
            Carregando suas listas...
          </div>
          <div id="listsContainer" style="display: none;">
            <!-- As listas serão carregadas aqui via JavaScript -->
          </div>
          <div id="noLists" style="display: none;">
            Você ainda não criou nenhuma lista
          </div>
        </div>

        <!-- Botões de ação -->
        <button class="popup-option create-list" onclick="showCreateListForm()">
          <span class="icon">+</span>
          <span>Criar Nova Lista</span>
        </button>
      </div>

      <!-- Formulário de criar lista -->
      <div class="popup-content" id="createListForm" style="display: none;">
        <form onsubmit="createNewList(event)">
          <div class="form-group">
            <label for="listName">Nome da Lista:</label>
            <input type="text" id="listName" placeholder="Ex: Meus Filmes Favoritos" required>
          </div>
          <div class="form-actions">
            <button type="button" onclick="showListOptions()">Voltar</button>
            <button type="submit">Criar Lista</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  {% include 'backstage/_mobile_search.html' %}
  {% include 'backstage/_mobile_bottom_nav.html' %}
  {% include 'backstage/_mobile_scripts.html' %}

    <script src="{% static 'js/intro.js' %}"></script>
    <script src="{% static 'js/main.js' %}?v=3.0" defer></script>
    <script src="{% static 'js/profile_menu.js' %}" defer></script>
    <script src="{% static 'js/search-suggestions.js' %}" defer></script>
    <script src="{% static 'js/notifications.js' %}" defer></script>
    
    <script>
    // Sistema de Lista no Hero
    document.addEventListener('DOMContentLoaded', function() {
      // Adicionar evento ao botão "Adicionar à Lista" no hero
      const heroAddBtn = document.querySelector('.hero-actions .btn-secondary');
      if (heroAddBtn) {
        heroAddBtn.addEventListener('click', function() {
          // Pegar o ID do filme atual do hero
          const heroTitle = document.querySelector('.hero-title');
          if (heroTitle) {
            const movieId = heroTitle.dataset.movieId;
            if (movieId) {
              window.currentHeroMovieId = movieId;
              loadUserLists();
              document.getElementById('listPopupOverlay').classList.add('show');
              document.body.style.overflow = 'hidden';
            }
          }
        });
      }
    });

    function hideListPopup() {
      document.getElementById('listPopupOverlay').classList.remove('show');
      document.body.style.overflow = '';
    }

    function showCreateListForm() {
      document.getElementById('popupOptions').style.display = 'none';
      document.getElementById('createListForm').style.display = 'block';
      document.getElementById('popupTitle').textContent = 'Criar Nova Lista';
      setTimeout(() => document.getElementById('listName').focus(), 100);
    }

    function showListOptions() {
      document.getElementById('popupOptions').style.display = 'block';
      document.getElementById('createListForm').style.display = 'none';
      document.getElementById('popupTitle').textContent = 'Adicionar à Lista';
    }

    function createNewList(event) {
      event.preventDefault();
      const name = document.getElementById('listName').value.trim();
      if (name) {
        fetch('/api/criar-lista/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: JSON.stringify({nome: name, publica: false})
        })
        .then(response => {
          if (response.status === 401) {
            window.location.href = '/login/';
            return;
          }
          return response.json();
        })
        .then(data => {
          if (!data) return;
          if (data.success) {
            alert('Lista "' + name + '" criada!');
            document.getElementById('listName').value = '';
            showListOptions();
            loadUserLists();
          } else {
            alert('Erro: ' + data.message);
          }
        });
      }
    }

    function loadUserLists() {
      const loadingEl = document.getElementById('loadingLists');
      const containerEl = document.getElementById('listsContainer');
      const noListsEl = document.getElementById('noLists');

      loadingEl.style.display = 'block';
      containerEl.style.display = 'none';
      noListsEl.style.display = 'none';

      fetch('/api/buscar-listas/?tipo=filme', {
        method: 'GET',
        headers: {
          'X-CSRFToken': getCookie('csrftoken')
        }
      })
      .then(response => {
        if (response.status === 401) {
          window.location.href = '/login/';
          return;
        }
        return response.json();
      })
      .then(data => {
        if (!data) return;
        loadingEl.style.display = 'none';

        if (data.success && data.listas.length > 0) {
          // Separar "Assistir Mais Tarde" das outras listas
          const assistirMaisTarde = data.listas.find(l => l.nome === "Assistir Mais Tarde");
          const outrasListas = data.listas.filter(l => l.nome !== "Assistir Mais Tarde");
          
          let html = '';
          
          // Adicionar "Assistir Mais Tarde" primeiro com estilo especial
          if (assistirMaisTarde) {
            html += `
              <div class="list-item list-item-featured">
                <div class="list-item-info">
                  <div class="list-item-name">${assistirMaisTarde.nome}</div>
                  <div class="list-item-meta">${assistirMaisTarde.count} filme${assistirMaisTarde.count !== 1 ? 's' : ''}</div>
                </div>
                <button class="list-item-add" onclick="addMovieToList(${assistirMaisTarde.id}, '${assistirMaisTarde.nome}')">
                  Adicionar
                </button>
              </div>
            `;
          }
          
          // Adicionar outras listas
          html += outrasListas.map(lista => `
            <div class="list-item">
              <div class="list-item-info">
                <div class="list-item-name">${lista.nome}</div>
                <div class="list-item-meta">${lista.count} filme${lista.count !== 1 ? 's' : ''}</div>
              </div>
              <button class="list-item-add" onclick="addMovieToList(${lista.id}, '${lista.nome}')">
                Adicionar
              </button>
            </div>
          `).join('');
          
          containerEl.innerHTML = html;
          containerEl.style.display = 'block';
        } else {
          noListsEl.style.display = 'block';
        }
      })
      .catch(error => {
        console.error('Erro ao carregar listas:', error);
        loadingEl.style.display = 'none';
        noListsEl.style.display = 'block';
        noListsEl.textContent = 'Erro ao carregar listas';
      });
    }

    function addMovieToList(listaId, listaNome) {
      const tmdbId = window.currentHeroMovieId;

      if (!tmdbId) {
        alert('Erro: ID do filme não encontrado');
        return;
      }

      fetch(`/api/lista/${listaId}/adicionar/${tmdbId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken')
        }
      })
      .then(response => {
        if (response.status === 401) {
          window.location.href = '/login/';
          return;
        }
        return response.json();
      })
      .then(data => {
        if (!data) return;
        if (data.success) {
          alert('Filme adicionado à lista "' + listaNome + '"!');
          loadUserLists();
          hideListPopup();
        } else {
          alert('Erro: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Erro ao adicionar filme à lista:', error);
        alert('Erro ao adicionar filme à lista');
      });
    }

    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // Fechar popup clicando fora
    document.getElementById('listPopupOverlay')?.addEventListener('click', function(e) {
      if (e.target === this) {
        hideListPopup();
      }
    });
    </script>
</body>
</html>    