{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ serie.titulo }} — Backstage</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/series_details.css' %}">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <nav class="nav-primary">
        <a class="brand" href="{% url 'backstage:index' %}">
            <img src="{% static 'images/Logo_Backstage_branca.png' %}"
                 alt="Backstage Logo"
                 width="40" height="40">
            <span class="brand-text">Backstage</span>
        </a>

        <div class="nav-menu">
          <a href="{% url 'backstage:index' %}" class="nav-link">Início</a>
          <div class="nav-link-wrapper">
            <a href="{% url 'backstage:noticias' %}" class="nav-link">Notícias</a>
            <div class="news-dropdown">
              <div class="dropdown-header">
                <h3>Últimas Notícias</h3>
                <a href="{% url 'backstage:noticias' %}" class="view-all">Ver todas</a>
              </div>
              <div class="news-dropdown-content">
                <!-- News items will be populated by JS -->
              </div>
            </div>
          </div>
          <a href="{% url 'backstage:movies' %}" class="nav-link">Filmes</a>
          <a href="{% url 'backstage:series' %}" class="nav-link active">Séries</a>
          <a href="{% url 'backstage:lists' %}" class="nav-link">Listas</a>
          <a href="{% url 'backstage:comunidade' %}" class="nav-link">Comunidade</a>
        </div>

        <div class="nav-actions">
          <div class="search-container">
            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
              <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <input type="search" class="search-input" placeholder="Buscar séries..." />
          </div>

          <button class="icon-btn notification-btn" aria-label="Notificações">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M12 2a7 7 0 0 1 7 7c0 5.25 1.5 6.75 1.5 6.75H3.5S5 14.25 5 9a7 7 0 0 1 7-7z" stroke="currentColor" stroke-width="2"/>
              <path d="M10.5 19a1.5 1.5 0 0 0 3 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span class="notification-badge">3</span>
          </button>

          <div class="user-menu">
            <button class="user-avatar">
              <img src="https://ui-avatars.com/api/?name=User&background=667eea&color=fff&bold=true" alt="Avatar" />
            </button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <section class="movie-hero">
    <div class="movie-backdrop">
      <img src="{{ tmdb_image_base }}original{{ serie.backdrop_path|default:serie.poster_path }}" alt="{{ serie.titulo }} backdrop" />
      <div class="movie-backdrop-gradient"></div>
    </div>
    
    <div class="container movie-hero-content">
      <div class="movie-poster-section">
        <img src="{{ tmdb_image_base }}w500{{ serie.poster_path }}" alt="{{ serie.titulo }} poster" class="movie-poster" />
        <button class="trailer-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M8 5v14l11-7z"/>
          </svg>
          Assistir Trailer
        </button>
      </div>
      
      <div class="series-info-section" data-serie-id="{{ serie.tmdb_id }}">
        <div class="movie-header">
          <h1 class="movie-title">{{ serie.titulo }}</h1>
          <span class="movie-original-title">{{ serie.titulo_original }}</span>
        </div>
        
        <div class="movie-metadata">
          <span class="movie-year">{{ serie.data_primeira_exibicao|date:"Y"|default:"2024" }}</span>
          <span class="series-seasons">{{ serie.numero_temporadas }} Temporada{{ serie.numero_temporadas|pluralize:"s" }}</span>
          <span class="series-episodes">{{ serie.numero_episodios }} Episódio{{ serie.numero_episodios|pluralize:"s" }}</span>
          <span class="series-status">{{ serie.status }}</span>
          <div class="movie-genres">
            {% for genero in serie.generos %}
            <span class="genre-tag">{{ genero }}</span>
            {% empty %}
            <span class="genre-tag">Gênero não disponível</span>
            {% endfor %}
          </div>
        </div>
        
        <div class="movie-ratings">
          <div class="rating-box imdb">
            <span class="rating-source">IMDb</span>
            <div class="rating-value">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#f5c518">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <strong>{{ serie.nota_tmdb|floatformat:1|default:"8.0" }}</strong>/10
            </div>
            <span class="rating-count">{{ serie.votos|default:"0" }} votos</span>
          </div>
          
          <div class="rating-box backstage">
            <span class="rating-source">Backstage</span>
            <div class="rating-value">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#667eea">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <strong>4.5</strong>/5
            </div>
            <span class="rating-count">{{ criticas.count }} avaliações</span>
          </div>
        </div>
        
        <div class="movie-synopsis">
          <p>{{ serie.sinopse|default:"Sinopse não disponível" }}</p>
        </div>
        
        <div class="movie-actions">
          <div class="action-buttons">
            <button class="action-btn watched">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              Assistido
            </button>
            <button class="action-btn watchlist">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2v20M5 12h14"/>
              </svg>
              Quero Ver
            </button>
            <button class="action-btn favorite">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
              </svg>
              Favoritar
            </button>
          </div>
          
          <div class="user-rating">
            <span class="rating-label">Sua avaliação:</span>
            <div class="star-rating">
              <button class="star" data-rating="1">★</button>
              <button class="star" data-rating="2">★</button>
              <button class="star" data-rating="3">★</button>
              <button class="star" data-rating="4">★</button>
              <button class="star" data-rating="5">★</button>
            </div>
            <form class="review-input-group" method="POST" action="{% url 'backstage:salvar_critica_serie' %}">
              {% csrf_token %}
              <input type="hidden" name="serie_id" value="{{ serie.tmdb_id }}">
              <input type="hidden" name="nota" id="rating-value" value="">
              <textarea 
                class="movie-review-text" 
                placeholder="Escreva sua crítica aqui..."
                name="texto"
                required
              ></textarea>
              <button type="submit" class="send-review-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                </svg>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main class="container movie-details">
    <div class="tabs-nav">
      <button class="tab-btn active" data-tab="overview">Visão Geral</button>
      <button class="tab-btn" data-tab="seasons">Temporadas</button>
      <button class="tab-btn" data-tab="crew">Equipe</button>
      <button class="tab-btn" data-tab="cast">Elenco</button>
      <button class="tab-btn" data-tab="reviews">Críticas</button>
    </div>

    <div class="tab-content active" id="overview">
      <div class="overview-grid">
        <div class="overview-main">
          <section class="crew-section">
            <h2 class="section-title">Criadores</h2>
            <div class="crew-grid">
              {% for criador in serie.criadores %}
              <div class="crew-member">
                <span class="crew-role">Criador</span>
                <span class="crew-name">{{ criador }}</span>
              </div>
              {% empty %}
              <p>Informações de criadores não disponíveis</p>
              {% endfor %}
            </div>
          </section>

          <section class="cast-section">
            <h2 class="section-title">Elenco Principal</h2>
            <div class="cast-grid" id="overview-cast-grid">
              {% for ator in serie.elenco_principal %}
              <div class="cast-member">
                {% if ator.foto_path %}
                <img src="{{ tmdb_image_base }}w185{{ ator.foto_path }}" alt="{{ ator.nome }}" class="cast-photo" />
                {% else %}
                <img src="https://ui-avatars.com/api/?name={{ ator.nome }}&background=667eea&color=fff" alt="{{ ator.nome }}" class="cast-photo" />
                {% endif %}
                <div class="cast-info">
                  <span class="cast-name">{{ ator.nome }}</span>
                  <span class="cast-character">{{ ator.personagem }}</span>
                </div>
              </div>
              {% empty %}
              <p>Elenco não disponível</p>
              {% endfor %}
            </div>
          </section>

          <section class="reviews-section">
            <div class="section-header">
              <h2 class="section-title">Críticas dos Usuários</h2>
            </div>
            
            <div class="reviews-list">
              {% for critica in criticas %}
              <article class="review-card">
                <div class="review-header">
                  <img src="https://ui-avatars.com/api/?name={{ critica.usuario.username }}&background=667eea&color=fff" alt="{{ critica.usuario.username }}" class="reviewer-avatar" />
                  <div class="reviewer-info">
                    <span class="reviewer-name">{{ critica.usuario.username }}</span>
                    <div class="review-meta">
                      <span class="review-rating">
                        {% for star in "12345" %}
                          {% if forloop.counter <= critica.nota %}★{% else %}☆{% endif %}
                        {% endfor %}
                      </span>
                      <span class="review-date">{{ critica.criado_em|timesince }} atrás</span>
                    </div>
                  </div>
                </div>
                <p class="review-text">{{ critica.texto }}</p>
              </article>
              {% empty %}
              <div class="no-reviews">
                <p>Ainda não há críticas para esta série. Seja o primeiro a avaliar!</p>
              </div>
              {% endfor %}
            </div>
          </section>
        </div>

        <aside class="overview-sidebar">
          <section class="movie-facts">
            <h3 class="sidebar-title">Informações</h3>
            <dl class="facts-list">
              <dt>Status</dt>
              <dd>{{ serie.status }}</dd>
              
              <dt>Rede Original</dt>
              <dd>
                {% for rede in serie.redes %}
                  {{ rede }}{% if not forloop.last %}, {% endif %}
                {% empty %}
                  Não disponível
                {% endfor %}
              </dd>
              
              <dt>Primeira Exibição</dt>
              <dd>{{ serie.data_primeira_exibicao|date:"d/m/Y"|default:"Não disponível" }}</dd>
              
              <dt>Última Exibição</dt>
              <dd>{{ serie.data_ultima_exibicao|date:"d/m/Y"|default:"Em exibição" }}</dd>
              
              <dt>Total de Episódios</dt>
              <dd>{{ serie.numero_episodios }} episódios</dd>
              
              <dt>Temporadas</dt>
              <dd>{{ serie.numero_temporadas }} temporadas</dd>
            </dl>
          </section>

          <section class="social-stats">
            <h3 class="sidebar-title">Estatísticas</h3>
            <div class="stats-list">
              <div class="stat-item">
                <span class="stat-icon">👁️</span>
                <div class="stat-info">
                  <span class="stat-number">0</span>
                  <span class="stat-label">Assistiram</span>
                </div>
              </div>
              <div class="stat-item">
                <span class="stat-icon">❤️</span>
                <div class="stat-info">
                  <span class="stat-number">0</span>
                  <span class="stat-label">Favoritaram</span>
                </div>
              </div>
              <div class="stat-item">
                <span class="stat-icon">📝</span>
                <div class="stat-info">
                  <span class="stat-number">{{ criticas.count }}</span>
                  <span class="stat-label">Críticas</span>
                </div>
              </div>
            </div>
          </section>
        </aside>
      </div>
    </div>

    <div class="tab-content" id="seasons">
      <div class="temporadas-section">
        <div class="section-header">
          <h2 class="section-title">Temporadas</h2>
          <span class="season-count">{{ serie.numero_temporadas }} temporadas • {{ serie.numero_episodios }} episódios</span>
        </div>
        
        <div class="seasons-list" id="seasons-list">
          <!-- Será preenchido via JavaScript -->
        </div>
      </div>
    </div>

    <div class="tab-content" id="crew">
      <div class="crew-full-section">
        <div class="section-header">
          <h2 class="section-title">Equipe Completa</h2>
        </div>
        <div class="crew-grid-full">
          {% for membro in serie.equipe %}
          <div class="crew-card-full">
            <div class="crew-info-full">
              <h4 class="crew-name-full">{{ membro.nome }}</h4>
              <p class="crew-role-full">{{ membro.cargo }}</p>
            </div>
          </div>
          {% empty %}
          <p>Informações da equipe não disponíveis</p>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="tab-content" id="cast">
      <div class="cast-full-section">
        <div class="section-header">
          <h2 class="section-title">Elenco Completo</h2>
        </div>
        <div class="cast-grid-full">
          {% for ator in serie.elenco_principal %}
          <div class="cast-card">
            {% if ator.foto_path %}
            <img src="{{ tmdb_image_base }}w185{{ ator.foto_path }}" alt="{{ ator.nome }}" />
            {% else %}
            <img src="https://ui-avatars.com/api/?name={{ ator.nome }}&background=667eea&color=fff" alt="{{ ator.nome }}" />
            {% endif %}
            <div class="cast-info">
              <span class="actor-name">{{ ator.nome }}</span>
              <span class="character-name">{{ ator.personagem }}</span>
            </div>
          </div>
          {% empty %}
          <p>Elenco não disponível</p>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="tab-content" id="reviews">
      <div class="reviews-full-section">
        <div class="section-header">
          <h2 class="section-title">Críticas dos Usuários</h2>
        </div>
        
        <div class="reviews-list-full">
          {% for critica in criticas %}
          <article class="review-card">
            <div class="review-header">
              <img src="https://ui-avatars.com/api/?name={{ critica.usuario.username }}&background=667eea&color=fff" alt="{{ critica.usuario.username }}" class="reviewer-avatar" />
              <div class="reviewer-info">
                <span class="reviewer-name">{{ critica.usuario.username }}</span>
                <div class="review-meta">
                  <span class="review-rating">
                    {% for star in "12345" %}
                      {% if forloop.counter <= critica.nota %}★{% else %}☆{% endif %}
                    {% endfor %}
                  </span>
                  <span class="review-date">{{ critica.criado_em|timesince }} atrás</span>
                </div>
              </div>
            </div>
            <p class="review-text">{{ critica.texto }}</p>
          </article>
          {% empty %}
          <div class="no-reviews">
            <p>Ainda não há críticas para esta série.</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <div class="brand">
            <span class="logo">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <circle cx="12" cy="12" r="10" fill="url(#footer-gradient)" opacity="0.9"/>
                <path d="M9 8v8l7-4z" fill="white"/>
                <defs>
                  <linearGradient id="footer-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#667eea"/>
                    <stop offset="100%" style="stop-color:#764ba2"/>
                  </linearGradient>
                </defs>
              </svg>
            </span>
            <span class="brand-text">Backstage</span>
          </div>
          <p class="footer-description">
            Sua jornada cinematográfica começa aqui. Entre no Backstage e registre cada frame.
          </p>
        </div>
        
        <div class="footer-section">
          <h3 class="footer-title">Explorar</h3>
          <ul class="footer-links">
            <li><a href="{% url 'backstage:index' %}">Início</a></li>
            <li><a href="{% url 'backstage:movies' %}">Filmes</a></li>
            <li><a href="{% url 'backstage:series' %}">Séries</a></li>
            <li><a href="{% url 'backstage:lists' %}">Listas</a></li>
            <li><a href="{% url 'backstage:comunidade' %}">Comunidade</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2024 Backstage. Todos os direitos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Dados da série para JavaScript -->
  <script>
    window.serieData = {
      tmdbId: {{ serie.tmdb_id }},
      temporadas: {{ temporadas_json|safe }},
      videos: {{ videos_json|safe }}
    };
  </script>

  <script src="{% static 'js/main.js' %}" defer></script>
  <script src="{% static 'js/series_details.js' %}" defer></script>
</body>
</html>